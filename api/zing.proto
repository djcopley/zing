syntax = "proto3";

package zing;

import "api/user.proto";
import "api/message.proto";

option go_package = "github.com/djcopley/zing/api";

service Zing {
  // Login takes the username and password and returns a token for accessing messages
  rpc Login(LoginRequest) returns (LoginResponse);

  // Invalidates the user's tokens
  rpc Logout(LogoutRequest) returns (LogoutResponse);

  // Takes a user's id and streams back the messages currently in the server queue
  rpc GetMessages(GetMessagesRequest) returns (stream GetMessagesResponse);

  // Send a message to a user
  rpc SendMessage(SendMessageRequest) returns (SendMessageResponse);
}

message LoginRequest {
  string username = 1;
  string password = 2;
}
message LoginResponse {
  string token = 1;
}

message LogoutRequest {
  string token = 1;
}
message LogoutResponse {}

// GetMessageRequest sends the server the user's id and a token
message GetMessagesRequest {
  string token = 1;
}
message GetMessagesResponse {
  MessageMetadata metadata = 1;
  Message message = 2;
}

message SendMessageRequest {
  string token = 1;
  User to = 2;
  Message message = 3;
}
message SendMessageResponse {}
